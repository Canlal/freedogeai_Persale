<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeDogeAI Presale</title>
    <style>
        /* Gelişmiş CSS Stilleri */
        .wallet-connect-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4eff8 100%);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .wallet-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 15px 25px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
            border: none;
            color: white;
        }
        
        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .wallet-btn.metamask {
            background: linear-gradient(135deg, #F6851B 0%, #E2761B 100%);
        }
        
        .wallet-btn.trustwallet {
            background: linear-gradient(135deg, #3375BB 0%, #2A5F9E 100%);
        }
        
        .wallet-btn.connected {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .wallet-btn .wallet-icon {
            width: 24px;
            height: 24px;
        }
        
        .wallet-status {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: rgba(255,255,255,0.7);
        }
        
        .wallet-details {
            margin-top: 15px;
        }
        
        .wallet-details p {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="wallet-connect-section">
            <h2 style="margin-bottom: 20px; text-align: center;">Cüzdan Bağlantısı</h2>
            
            <button id="metamaskBtn" class="wallet-btn metamask">
                <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" class="wallet-icon">
                <span id="metamaskBtnText">MetaMask ile Bağlan</span>
                <span id="metamaskSpinner" class="loading-spinner" style="display: none;"></span>
            </button>
            
            <button id="trustwalletBtn" class="wallet-btn trustwallet">
                <img src="https://trustwallet.com/assets/images/media/assets/TWT.png" class="wallet-icon">
                <span id="trustwalletBtnText">Trust Wallet ile Bağlan</span>
                <span id="trustwalletSpinner" class="loading-spinner" style="display: none;"></span>
            </button>
            
            <div id="walletStatus" class="wallet-status">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="margin: 0;">Bağlantı Başarılı</h3>
                    <span id="networkIndicator" style="padding: 4px 8px; border-radius: 12px; font-size: 12px; background: #4CAF50; color: white;">BSC</span>
                </div>
                
                <div class="wallet-details">
                    <p><strong>Cüzdan Adresi:</strong> <span id="connectedAddress"></span></p>
                    <p><strong>BNB Bakiyesi:</strong> <span id="connectedBalance">0</span></p>
                    <p><strong>Ağ:</strong> <span id="connectedNetwork">Binance Smart Chain</span></p>
                </div>
                
                <button id="disconnectBtn" style="margin-top: 10px; background: #f44336; color: white; padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer;">
                    Bağlantıyı Kes
                </button>
            </div>
        </div>
        
        <!-- Diğer içerikler -->
    </div>

    <script>
        // Gelişmiş Cüzdan Yönetimi
        const WalletManager = {
            web3: null,
            userAddress: null,
            networkId: null,
            
            init: async function() {
                await this.autoConnect();
                this.setupEventListeners();
            },
            
            autoConnect: async function() {
                if (window.ethereum) {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                        if (accounts.length > 0) {
                            await this.connectWallet();
                        }
                    } catch (error) {
                        console.error("Auto-connect error:", error);
                    }
                }
            },
            
            connectWallet: async function() {
                if (!window.ethereum) {
                    this.showWalletModal();
                    return;
                }
                
                try {
                    // Hesapları iste
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    this.userAddress = accounts[0];
                    this.web3 = new Web3(window.ethereum);
                    
                    // Ağ bilgilerini al
                    this.networkId = await this.web3.eth.net.getId();
                    await this.checkNetwork();
                    
                    // Kullanıcı arayüzünü güncelle
                    this.updateUI();
                    
                    // Olay dinleyicilerini ayarla
                    this.setupWalletEvents();
                    
                } catch (error) {
                    console.error("Connection error:", error);
                    this.showError("Bağlantı hatası: " + (error.message || error));
                }
            },
            
            checkNetwork: async function() {
                // BSC Mainnet kontrolü (Chain ID: 56)
                if (this.networkId !== 56) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x38' }] // BSC Mainnet
                        });
                    } catch (switchError) {
                        // Zincir eklenmemişse ekle
                        if (switchError.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: '0x38',
                                        chainName: 'Binance Smart Chain',
                                        nativeCurrency: {
                                            name: 'BNB',
                                            symbol: 'BNB',
                                            decimals: 18
                                        },
                                        rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                        blockExplorerUrls: ['https://bscscan.com/']
                                    }]
                                });
                            } catch (addError) {
                                throw new Error("BSC ağına geçilemedi");
                            }
                        }
                    }
                }
            },
            
            updateUI: async function() {
                if (!this.userAddress) return;
                
                // Cüzdan bilgilerini göster
                document.getElementById('walletStatus').style.display = 'block';
                document.getElementById('connectedAddress').textContent = 
                    `${this.userAddress.substring(0, 6)}...${this.userAddress.substring(this.userAddress.length - 4)}`;
                
                // Bakiye bilgisini al
                const balance = await this.web3.eth.getBalance(this.userAddress);
                const bnbBalance = this.web3.utils.fromWei(balance, 'ether');
                document.getElementById('connectedBalance').textContent = 
                    parseFloat(bnbBalance).toFixed(4) + " BNB";
                
                // Buton durumlarını güncelle
                document.getElementById('metamaskBtnText').textContent = "Bağlandı";
                document.getElementById('trustwalletBtnText').textContent = "Bağlandı";
                document.getElementById('metamaskBtn').classList.add('connected');
                document.getElementById('trustwalletBtn').classList.add('connected');
            },
            
            disconnectWallet: function() {
                this.userAddress = null;
                this.web3 = null;
                this.networkId = null;
                
                // UI'yı sıfırla
                document.getElementById('walletStatus').style.display = 'none';
                document.getElementById('metamaskBtnText').textContent = "MetaMask ile Bağlan";
                document.getElementById('trustwalletBtnText').textContent = "Trust Wallet ile Bağlan";
                document.getElementById('metamaskBtn').classList.remove('connected');
                document.getElementById('trustwalletBtn').classList.remove('connected');
                
                console.log("Wallet disconnected");
            },
            
            setupWalletEvents: function() {
                // Hesap değişikliklerini dinle
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        this.disconnectWallet();
                    } else {
                        this.userAddress = accounts[0];
                        this.updateUI();
                    }
                });
                
                // Ağ değişikliklerini dinle
                window.ethereum.on('chainChanged', (chainId) => {
                    window.location.reload();
                });
            },
            
            setupEventListeners: function() {
                // MetaMask butonu
                document.getElementById('metamaskBtn').addEventListener('click', async () => {
                    document.getElementById('metamaskBtnText').style.display = 'none';
                    document.getElementById('metamaskSpinner').style.display = 'inline-block';
                    
                    try {
                        await this.connectWallet();
                    } catch (error) {
                        this.showError(error.message);
                    } finally {
                        document.getElementById('metamaskBtnText').style.display = 'inline';
                        document.getElementById('metamaskSpinner').style.display = 'none';
                    }
                });
                
                // Trust Wallet butonu
                document.getElementById('trustwalletBtn').addEventListener('click', async () => {
                    document.getElementById('trustwalletBtnText').style.display = 'none';
                    document.getElementById('trustwalletSpinner').style.display = 'inline-block';
                    
                    try {
                        await this.connectWallet();
                    } catch (error) {
                        this.showError(error.message);
                    } finally {
                        document.getElementById('trustwalletBtnText').style.display = 'inline';
                        document.getElementById('trustwalletSpinner').style.display = 'none';
                    }
                });
                
                // Bağlantıyı kes butonu
                document.getElementById('disconnectBtn').addEventListener('click', () => {
                    this.disconnectWallet();
                });
            },
            
            showWalletModal: function() {
                // Cüzdan yüklü değilse kurulum modalı göster
                const installWallet = confirm("Cüzdan uzantısı bulunamadı. MetaMask yüklemek ister misiniz?");
                if (installWallet) {
                    window.open('https://metamask.io/download.html', '_blank');
                }
            },
            
            showError: function(message) {
                // Hata mesajını göster
                alert(message);
            }
        };

        // Uygulamayı başlat
        window.addEventListener('DOMContentLoaded', () => {
            WalletManager.init();
        });
    </script>
</body>
</html>
