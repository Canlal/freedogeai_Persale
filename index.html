<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeDogeAI Presale</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Ã–nceki tÃ¼m CSS stilleri burada kalacak */
        /* Sadece animasyon kÄ±smÄ±nÄ± deÄŸiÅŸtirdim */
        
        /* Pure CSS Doge Animation */
        .doge-animation {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 1000;
            pointer-events: none;
            animation: float 3s ease-in-out infinite;
        }

        .doge-head {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #F5D393;
            border-radius: 50%;
            top: 25px;
            left: 25px;
            box-shadow: 0 0 20px rgba(245, 211, 147, 0.5);
        }

        .doge-ear-left {
            position: absolute;
            width: 40px;
            height: 60px;
            background: #E5C383;
            border-radius: 50% 50% 0 0;
            transform: rotate(-30deg);
            top: 5px;
            left: 15px;
        }

        .doge-ear-right {
            position: absolute;
            width: 40px;
            height: 60px;
            background: #E5C383;
            border-radius: 50% 50% 0 0;
            transform: rotate(30deg);
            top: 5px;
            right: 15px;
        }

        .doge-eye-left {
            position: absolute;
            width: 20px;
            height: 15px;
            background: #5A3A22;
            border-radius: 50%;
            top: 45px;
            left: 30px;
        }

        .doge-eye-right {
            position: absolute;
            width: 20px;
            height: 15px;
            background: #5A3A22;
            border-radius: 50%;
            top: 45px;
            right: 30px;
        }

        .doge-nose {
            position: absolute;
            width: 25px;
            height: 20px;
            background: #5A3A22;
            border-radius: 50%;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
        }

        .doge-mouth {
            position: absolute;
            width: 40px;
            height: 15px;
            border-bottom: 3px solid #5A3A22;
            border-radius: 0 0 50% 50%;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
        }

        .doge-tongue {
            position: absolute;
            width: 20px;
            height: 10px;
            background: #FF6B6B;
            border-radius: 0 0 10px 10px;
            top: 85px;
            left: 50%;
            transform: translateX(-50%);
            animation: tongue 2s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        @keyframes tongue {
            0%, 100% { height: 10px; }
            50% { height: 20px; }
        }

        /* BaÄŸlantÄ± durumu iÃ§in yeni stil */
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .connection-status.visible {
            opacity: 1;
        }
        
        .connection-status.success {
            background-color: rgba(0, 255, 102, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .connection-status.error {
            background-color: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }
    </style>
</head>
<body>
    <!-- Pure CSS Doge Animation -->
    <div class="doge-animation">
        <div class="doge-ear-left"></div>
        <div class="doge-ear-right"></div>
        <div class="doge-head"></div>
        <div class="doge-eye-left"></div>
        <div class="doge-eye-right"></div>
        <div class="doge-nose"></div>
        <div class="doge-mouth"></div>
        <div class="doge-tongue"></div>
    </div>

    <!-- BaÄŸlantÄ± durumu bildirimi -->
    <div id="connectionStatus" class="connection-status"></div>

    <div class="main-container">
        <!-- Ã–nceki HTML yapÄ±sÄ± aynen korunuyor -->
        <!-- Sadece baÄŸlantÄ± butonu ve ilgili alanlar -->
        <div class="left-column">
            <div class="container">
                <!-- ... diÄŸer elemanlar ... -->
                <button id="connectWalletBtn" data-i18n="connect_wallet">ðŸ”— Connect with MetaMask</button>
                <div id="walletInfo" style="display: none;">
                    <!-- CÃ¼zdan bilgileri -->
                </div>
                <!-- ... diÄŸer elemanlar ... -->
            </div>
        </div>
        <!-- ... saÄŸ kolon ve diÄŸer iÃ§erik ... -->
    </div>

    <script>
        const CONFIG = {
            RECEIVE_WALLET: "0xd924e01c7d319c5b23708cd622bd1143cd4fb360",
            TOKENS_PER_BNB: 120000000000,
            TOKENS_PER_USDT: 200000000,
            BSC_CHAIN_ID: 56,
            USDT_CONTRACT: "0x55d398326f99059fF775485246999027B3197955"
        };

        let web3;
        let userAddress = "";
        let usdtContract;
        let currentLanguage = 'en';
        let isConnecting = false; // BaÄŸlantÄ± durumunu takip etmek iÃ§in

        // BaÄŸlantÄ± durumu gÃ¶ster
        function showConnectionStatus(message, isSuccess) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = message;
            statusElement.className = `connection-status ${isSuccess ? 'success' : 'error'} visible`;
            
            // 3 saniye sonra kaybolsun
            setTimeout(() => {
                statusElement.classList.remove('visible');
            }, 3000);
        }

        // Ã‡eviri fonksiyonlarÄ± ve diÄŸer yardÄ±mcÄ± fonksiyonlar burada kalacak
        // ...

        async function connectWallet() {
            if (isConnecting) return; // Zaten baÄŸlanÄ±yorsa tekrar deneme
            isConnecting = true;
            
            try {
                // MetaMask kontrolÃ¼
                if (!window.ethereum) {
                    showConnectionStatus(getTranslation('no_metamask'), false);
                    redirectToMetaMask();
                    return;
                }

                // Birden fazla cÃ¼zdan varsa MetaMask'Ä± bul
                let ethereum = window.ethereum;
                if (window.ethereum.providers?.length) {
                    const metaMaskProvider = window.ethereum.providers.find(p => p.isMetaMask);
                    if (metaMaskProvider) {
                        ethereum = metaMaskProvider;
                    } else {
                        throw new Error(getTranslation('no_metamask'));
                    }
                } else if (!window.ethereum.isMetaMask) {
                    throw new Error(getTranslation('no_metamask'));
                }

                // HesaplarÄ± iste
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                
                if (accounts.length === 0) {
                    showConnectionStatus(getTranslation('connection_rejected'), false);
                    return;
                }

                userAddress = accounts[0];
                await initializeWeb3();
                await updateWalletUI();
                showConnectionStatus(getTranslation('connected_success'), true);
                
            } catch (error) {
                console.error("Connection error:", error);
                
                let errorMessage;
                if (error.code === 4001) {
                    // KullanÄ±cÄ± baÄŸlantÄ±yÄ± reddetti
                    errorMessage = getTranslation('connection_rejected');
                } else if (error.code === -32002) {
                    // Zaten bekleyen bir istek var
                    errorMessage = getTranslation('pending_request');
                } else {
                    errorMessage = getTranslation('connection_error') + (error.message ? `: ${error.message}` : '');
                }
                
                showConnectionStatus(errorMessage, false);
            } finally {
                isConnecting = false;
            }
        }

        // MetaMask yoksa yÃ¶nlendirme yap
        function redirectToMetaMask() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /android|iphone|ipad|ipod/i.test(userAgent);
            
            if (isMobile) {
                window.location.href = `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}`;
            } else {
                const installLink = document.createElement('a');
                installLink.href = 'https://metamask.io/download.html';
                installLink.target = '_blank';
                installLink.rel = 'noopener noreferrer';
                document.body.appendChild(installLink);
                installLink.click();
                document.body.removeChild(installLink);
            }
        }

        // Ã‡eviri sÃ¶zlÃ¼ÄŸÃ¼ne yeni mesajlar ekle
        const translations = {
            en: {
                // ... diÄŸer Ã§eviriler ...
                no_metamask: "MetaMask not installed!",
                connected_success: "Successfully connected!",
                connection_rejected: "Connection rejected by user",
                pending_request: "There's a pending request. Please check MetaMask",
                connection_error: "Connection error"
            },
            tr: {
                // ... diÄŸer Ã§eviriler ...
                no_metamask: "MetaMask yÃ¼klÃ¼ deÄŸil!",
                connected_success: "BaÅŸarÄ±yla baÄŸlandÄ±!",
                connection_rejected: "BaÄŸlantÄ± kullanÄ±cÄ± tarafÄ±ndan reddedildi",
                pending_request: "Bekleyen bir istek var. LÃ¼tfen MetaMask'Ä± kontrol edin",
                connection_error: "BaÄŸlantÄ± hatasÄ±"
            },
            // ... diÄŸer diller ...
        };

        // Ã‡eviri al
        function getTranslation(key) {
            return translations[currentLanguage]?.[key] || translations['en'][key] || key;
        }

        // Web3 ve kontrat baÅŸlatma
        async function initializeWeb3() {
            web3 = new Web3(window.ethereum);
            
            const usdtAbi = [{
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "balance", "type": "uint256"}],
                "type": "function"
            }, {
                "constant": false,
                "inputs": [
                    {"name": "_to", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "transfer",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            }];
            
            usdtContract = new web3.eth.Contract(usdtAbi, CONFIG.USDT_CONTRACT);
            
            try {
                const chainId = Number(await web3.eth.getChainId());
                if (chainId !== CONFIG.BSC_CHAIN_ID) {
                    await switchToBSCNetwork();
                }
            } catch (error) {
                console.log("Network check failed:", error);
                showConnectionStatus(getTranslation('wrong_network'), false);
            }
        }

        // AÄŸ deÄŸiÅŸtirme fonksiyonu
        async function switchToBSCNetwork() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x38' }]
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x38',
                                chainName: 'Binance Smart Chain',
                                nativeCurrency: {
                                    name: 'BNB',
                                    symbol: 'BNB',
                                    decimals: 18
                                },
                                rpcUrls: ['https://bsc-dataseed.binance.org/'],
                                blockExplorerUrls: ['https://bscscan.com']
                            }]
                        });
                    } catch (addError) {
                        console.error("Error adding BSC network:", addError);
                        throw addError;
                    }
                } else {
                    console.error("Error switching to BSC network:", switchError);
                    throw switchError;
                }
            }
        }

        // CÃ¼zdan UI gÃ¼ncelleme
        async function updateWalletUI() {
            const shortAddress = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
            document.getElementById('walletAddress').textContent = shortAddress;
            
            document.getElementById('walletInfo').style.display = 'block';
            document.getElementById('connectWalletBtn').textContent = 'âœ… ' + getTranslation('connected');
            document.getElementById('buyBtn').disabled = false;
            
            try {
                const bnbBalance = await web3.eth.getBalance(userAddress);
                document.getElementById('bnbBalance').textContent = `${web3.utils.fromWei(bnbBalance, 'ether').slice(0, 8)} BNB`;
                
                const usdtBalance = await usdtContract.methods.balanceOf(userAddress).call();
                document.getElementById('usdtBalance').textContent = `${web3.utils.fromWei(usdtBalance, 'ether')} USDT`;
            } catch (error) {
                console.error("Balance fetch error:", error);
            }
        }

        // Sayfa yÃ¼klendiÄŸinde
        window.addEventListener('DOMContentLoaded', () => {
            // Dil seÃ§ici
            document.getElementById('languageSelector').addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                translatePage(currentLanguage);
            });
            
            // BaÄŸlan butonu
            document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
            
            // DiÄŸer event listener'lar...
            
            // Ã–nceden baÄŸlÄ± cÃ¼zdan kontrolÃ¼
            if (window.ethereum) {
                checkConnectedWallet();
                
                // Hesaplar deÄŸiÅŸtiÄŸinde
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length > 0) {
                        userAddress = accounts[0];
                        updateWalletUI();
                        showConnectionStatus(getTranslation('account_changed'), true);
                    } else {
                        // CÃ¼zdan baÄŸlantÄ±sÄ± kesildi
                        document.getElementById('walletInfo').style.display = 'none';
                        document.getElementById('connectWalletBtn').textContent = 'ðŸ”— ' + getTranslation('connect_wallet');
                        document.getElementById('buyBtn').disabled = true;
                        showConnectionStatus(getTranslation('disconnected'), false);
                    }
                });
                
                // Zincir deÄŸiÅŸtiÄŸinde
                window.ethereum.on('chainChanged', () => {
                    window.location.reload();
                });
            }
        });

        // Ã–nceden baÄŸlÄ± cÃ¼zdan kontrolÃ¼
        async function checkConnectedWallet() {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    userAddress = accounts[0];
                    initializeWeb3();
                    await updateWalletUI();
                }
            } catch (error) {
                console.error("Error checking connected wallet:", error);
            }
        }

        // DiÄŸer fonksiyonlar (calculateFDAI, sendPayment vb.) aynen kalacak
        // ...
    </script>
</body>
</html>
